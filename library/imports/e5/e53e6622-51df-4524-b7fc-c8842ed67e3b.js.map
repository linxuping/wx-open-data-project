{"version":3,"sources":["../../../assets/assets/launch.js"],"names":["cc","Class","extends","Component","properties","tips","Label","content","Node","prefab","Prefab","preview","ScrollView","display","None","start","wx","onMessage","console","log","data","message","initTips","initUserInfo","initFriendInfo","renderTypeStr","game","renderType","RENDER_TYPE_WEBGL","string","getUserInfo","openIdList","lang","success","res","createUserBlock","fail","error","getFriendCloudStorage","i","length","user","node","instantiate","parent","x","userName","getChildByName","getComponent","nickName","nickname","loader","load","url","avatarUrl","type","err","texture","userIcon","children","Sprite","spriteFrame","SpriteFrame"],"mappings":"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","file":"launch.js","sourceRoot":"../../../assets","sourcesContent":["//\n// api: https://developers.weixin.qq.com/minigame/dev/document/open-api/data/wx.getUserInfo.html\n//\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tips: cc.Label,\n        content: cc.Node,\n        prefab: cc.Prefab,\n        preview: cc.ScrollView,\n        display: cc.None,\n    },\n\n    start () {\n        if (typeof wx === 'undefined') {\n            return;\n        }\n        wx.onMessage( data => {\n            console.log(\"[wx-open-data] wx.onMessage data: \", data);\n            if (data.message) {\n                console.log(data.message);\n            }\n        });\n        this.initTips();\n        this.initUserInfo();\n        this.initFriendInfo();\n    },\n\n    initTips () {\n        let renderTypeStr = 'Canvas';\n        if (cc.game.renderType === cc.game.RENDER_TYPE_WEBGL) {\n            renderTypeStr = 'WEBGL';\n        }\n        this.tips.string = `开放数据域当前支持 ${renderTypeStr} 渲染模式`;\n    },\n\n    initUserInfo () {\n        wx.getUserInfo({\n            openIdList: ['selfOpenId'],\n            lang: 'zh_CN',\n            success: (res) => {\n                this.createUserBlock(res.data[0]);\n                this.createUserBlock(res.data[0]);\n                this.createUserBlock(res.data[0]);\n            },\n            fail: (res) => {\n                console.error(res);\n            }\n        });\n    },\n\n    initFriendInfo () {\n        wx.getFriendCloudStorage({\n            success: (res) => {\n                for (let i = 0; i < res.data.length; ++i) {\n                    this.createUserBlock(res.data[i]);\n                }\n            },\n            fail: (res) => {\n                console.error(res);\n            }\n        });\n    },\n\n    createUserBlock (user) {\n        let node = cc.instantiate(this.prefab);\n        node.parent = this.content;\n        node.x = 0;\n\n        // set nickName\n        let userName = node.getChildByName('userName').getComponent(cc.Label);\n        userName.string = user.nickName || user.nickname;\n\n        // set avatar\n        cc.loader.load({url: user.avatarUrl, type: 'png'}, (err, texture) => {\n            if (err) console.error(err);\n            let userIcon = node.getChildByName('mask').children[0].getComponent(cc.Sprite);\n            userIcon.spriteFrame = new cc.SpriteFrame(texture);\n        });\n        \n    }\n\n});\n"]}